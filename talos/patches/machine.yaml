machine:
  sysctls:
    # Matter mdns https://github.com/project-chip/matter.js/blob/main/docs/TROUBLESHOOTING.md
    net.ipv6.conf.all.forwarding: 0
    net.ipv6.conf.all.accept_ra: 1
    net.ipv6.conf.all.accept_ra_rt_info_max_plen: 64
    # Quic UDP https://github.com/quic-go/quic-go/wiki/UDP-Buffer-Sizes
    net.core.rmem_max: 7500000
    net.core.wmem_max: 7500000
  kubelet:
    extraArgs:
      cloud-provider: external
      rotate-server-certificates: true
      feature-gates: DynamicResourceAllocation=true
  features:
    hostDNS:
      enabled: false
      forwardKubeDNSToHost: false
  files:
  # Spegel needs unpacked layers
  - path: /etc/cri/conf.d/20-customization.part
    op: create
    content: |
      [plugins."io.containerd.cri.v1.images"]
        discard_unpacked_layers = false
      [plugins."io.containerd.grpc.v1.cri"]
        enable_cdi = true
        cdi_specs_dir = ["/etc/cdi", "/var/run/cdi"]
